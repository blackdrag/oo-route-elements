<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../iron-selector/iron-selectable.html">

<dom-module id="canoo-routes">

  <script>
    const NO_MATCH = false

    class CanooRoutes extends Polymer.mixinBehaviors(
      [Polymer.IronSelectableBehavior], Polymer.Element) {

      static get is() {
        return "canoo-routes"
      }

      static get properties() {
        return {
          route: {
            type: String
          },
          params: {
            type: String,
            notify: true
          }
        }
      }

      ready() {
        super.ready()
        this.addEventListener("iron-items-changed", this._onItemsChanged)
      }

      _onItemsChanged() {
        for (const itemIndex in this.items) {
          const routeItem = this.items[itemIndex]
          const routeParams = this._matchRoute(routeItem)
          if (routeParams !== NO_MATCH) {
            this.selectIndex(itemIndex)
            this.params = routeParams
            break
          }
        }
      }

      _matchRoute(routeItem) {
        return matchRoutePathRegexp(this.route, routeItem.pattern)
      }
    }

    function matchRoutePathRegexp(path, pattern) {
      const regexp = new RegExp(pattern)
      const match = regexp.exec(path)

      // Did match regular expression.
      if (match) {
        return match.slice(1)
      }

      // Did not match.
      return NO_MATCH
    }

    window.customElements.define(CanooRoutes.is, CanooRoutes)
  </script>

</dom-module>
